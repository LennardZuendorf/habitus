<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

    <head>
        <title>HABIT</title>
        <meta http-equiv="Content-Type" content="text/html"/>
        <meta charset="UTF-8">
        <link rel="icon" type="image/svg" th:href="@{/img/logo_clean.svg}"/>
        <link  th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css}" rel="stylesheet">
        <link th:href="@{https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.6.0/mdb.min.css}" rel="stylesheet">
        <link th:href="@{/css/Style.css}" rel="stylesheet" >
        <link th:href="@{https://global.oktacdn.com/okta-signin-widget/5.7.3/css/okta-sign-in.min.css}" type="text/css" rel="stylesheet"/>
        <script th:src="@{/js/ColorMode.js}" type="text/javascript"></script>
        <script th:src="@{/js/Login.js}" type="text/javascript"></script>
        <script th:src="@{https://unpkg.com/vue@next}"></script>
        <script src="https://global.oktacdn.com/okta-signin-widget/5.7.3/js/okta-sign-in.min.js" type="text/javascript"></script>
        <script type="text/javascript">
            (function () {if (localStorage.getItem("colorMode") === "light") {
                toggleColor();}})(); </script>

    </head>

    <body class="dark-mode bg-bg">

        <!-- navbar -->
        <div th:insert="fragments/fragments :: navbar"></div>
        <!-- navbar -->

        <!-- logo & text -->
        <div class="container-fluid" style="height: 100%">

            <!-- logo row-->
            <div class="row align-items-center justify-content-center bg-bg" style="padding-top: 5%">
                <div class="d-flex justify-content-center">
                    <img src="/img/logo.svg"
                         height="300px"
                         alt=""
                         loading="lazy"
                    />
                </div>
            </div>
            <!-- logo row-->

            <!-- login register row-->
            <div class="row align-items-center justify-content-center" style="padding-top: 5%">
                <div class="d-flex justify-content-center">

                    <!-- login button -->
                    <button type="button" class="btn btn-rounded login-button" data-mdb-toggle="modal" data-mdb-target="#loginModal">
                        LOGIN | REGISTER
                    </button>
                    <!-- login button -->

                    <!-- login modal -->
                    <div
                            class="modal fade "
                            id="loginModal"
                            tabindex="-1"
                            aria-labelledby="loginModalLabel"
                            aria-hidden="true"
                    >
                        <div class="modal-dialog">
                            <div class="modal-content custom-modal">
                                <div class="modal-header">
                                    <a class="modal-title" id="loginModalLabel" >LOGIN | REGISTER</a>
                                    <button
                                            type="button"
                                            class="btn-close"
                                            data-mdb-dismiss="modal"
                                            aria-label="Close"
                                    ></button>
                                </div>
                                <div class="modal-body">
                                    <a th:href="@{/dashboard}">LOGIN | REGISTER</a>
                                    <div id="okta-login-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- login register row-->
        </div>
        <!-- logo & text -->

        <!-- footer -->
        <div th:insert="fragments/fragments :: footer"></div>
        <!-- footer -->

    </body>

    <!-- bootstrap js -->

    <script type="text/javascript">
        const oktaSignIn = new OktaSignIn({
            baseUrl: "https://dev-22030587.okta.com/",
            clientId: "${OKTA_CLIENT_ID}",
            authParams: {
                issuer: "https://dev-22030587.okta.com/oauth2/default"
            }
        });

        oktaSignIn.authClient.token.getUserInfo().then(function(user) {
            document.getElementById("messageBox").innerHTML = "Hello, " + user.email + "! You are *still* logged in! :)";
            document.getElementById("logout").style.display = 'block';
        }, function(error) {
            oktaSignIn.showSignInToGetTokens({
                el: '#okta-login-container'
            }).then(function(tokens) {
                oktaSignIn.authClient.tokenManager.setTokens(tokens);
                oktaSignIn.remove();

                const idToken = tokens.idToken;
                document.getElementById("messageBox").innerHTML = "Hello, " + idToken.claims.email + "! You just logged in! :)";
                document.getElementById("logout").style.display = 'block';

            }).catch(function(err) {
                console.error(err);
            });
        });

        function logout() {
            oktaSignIn.authClient.signOut();
            location.reload();
        }
    </script>
    <script type="text/javascript">
        // set correct color mode immediately
        (function () {
            if (localStorage.getItem("colorMode") === "light") {
                toggleColor();
            }
        })();
    </script>
    <script  src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.6.0/mdb.min.js" type="text/javascript"></script>

</html>